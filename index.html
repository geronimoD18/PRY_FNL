<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Agenda web">
    <meta name="author" content="Yunior Feliz">
    <title>Agenda Web</title>
    <link rel="icon" href="/docs/4.0/assets/img/favicons/favicon.ico">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
    <!-- MDB -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.3.2/mdb.min.css" rel="stylesheet" />
</head>

<body class="bg-light">

    <div class="container">
        <div class="py-5 text-center">
            <img class="d-block mx-auto mb-4 rounded-4 shadow" src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/99/Unofficial_JavaScript_logo_2.svg/1200px-Unofficial_JavaScript_logo_2.svg.png" alt="" width="72" height="72">
            <h2>Contactos JS</h2>
            <p class="lead">Aplicación de contactos que almacena los datos en el navegador utilizando <strong><i>localStorage</i></strong>.</p>
        </div>

        <div class="row">
            <div class="col-md-4 order-md-2 mb-4">
                <h4 class="d-flex justify-content-between align-items-center mb-3">
                    <span class="text-muted">Tus contactos</span>
                    <span class="badge badge-secondary badge-pill" id="contact-count">0</span>
                </h4>
                <ul class="list-group mb-3" id="contacts-list">
                    <!-- Contacts will be displayed here -->
                </ul>
            </div>
            <div class="col-md-8 order-md-1">
                <h4 class="mb-3">Información personal</h4>
                <form class="needs-validation" id="contact-form" novalidate>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="firstName">Nombre</label>
                            <input type="text" class="form-control" id="firstName" placeholder="" value="" required>
                            <div class="invalid-feedback">
                                Introduce un nombre
                            </div>
                            <div class="valid-feedback">
                                Perfecto!
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="lastName">Apellido</label>
                            <input type="text" class="form-control" id="lastName" placeholder="" value="" required>
                            <div class="invalid-feedback">
                                Introduce un apellido
                            </div>
                            <div class="valid-feedback">
                                Perfecto!
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="email">Email</label>
                            <input type="email" class="form-control" id="email" placeholder="" value="" required>
                            <div class="invalid-feedback">
                                Introduce un correo electrónico válido
                            </div>
                            <div class="valid-feedback">
                                Perfecto!
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="phone">Teléfono</label>
                            <input type="number" class="form-control" id="phone" placeholder="" value="" required>
                            <div class="invalid-feedback">
                                Introduce un número de teléfono válido
                            </div>
                            <div class="valid-feedback">
                                Perfecto!
                            </div>
                        </div>
                    </div>

                    <hr class="">
                    <div class="custom-control custom-checkbox mb-3">
                        <input type="checkbox" class="custom-control-input" id="save-info" name="allow-emails">
                        <label class="custom-control-label" for="save-info">Permitir enviar correos</label>
                    </div>
                    <hr class="mb-4">

                    <h4 class="mb-3">Información profesional</h4>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="business">Empresa / Institución</label>
                            <input type="text" class="form-control" id="business" placeholder="">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="position">Cargo / posición</label>
                            <input type="text" class="form-control" id="position" placeholder="">
                        </div>
                    </div>
                    <hr class="mb-4">
                    <button class="btn btn-primary btn-lg btn-block" onclick="saveContact(event)" data-mdb-ripple-init type="submit">Guardar contacto</button>
                </form>
            </div>
        </div>

        <!-- info modal -->
        <div class="modal fade" id="contactModal" tabindex="-1" aria-labelledby="contactModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="contactModalLabel">Detalles del contacto</h5>
                        <button type="button" class="btn-close" data-mdb-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="modal-body-content">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-mdb-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>


        <footer class="my-5 pt-5 text-muted text-center text-small">
            <p class="mb-1">&copy; 2024 Yunior Contacts</p>
            <ul class="list-inline">
                <li class="list-inline-item"><a href="#">Privacy</a></li>
                <li class="list-inline-item"><a href="#">Terms</a></li>
                <li class="list-inline-item"><a href="#">Support</a></li>
            </ul>
        </footer>
    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script>
        window.jQuery || document.write('<script src="../../assets/js/vendor/jquery-slim.min.js"><\/script>')
    </script>
    <!-- MDB -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.3.2/mdb.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        function saveContact(event) {
            event.preventDefault(); // función para evitar que se envíen los datos, recargue la página y se pueda validar el formulario

            // validar cada campo para asegurarnos de que no están vacíos 
            const form = document.getElementById('contact-form');
            if (form.checkValidity() === false) {
                form.classList.add('was-validated');
                return;
            }

            // se recolectan los datos que se introdujeron en los input
            const name = document.getElementById('firstName').value + ' ' + document.getElementById('lastName').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const business = document.querySelector('#business').value;
            const position = document.querySelector('#position').value;
            const allowEmails = document.getElementById('save-info').checked ? 'Permitir Correos' : 'No Correos';

            // se inicializa un nuevo arreglo con los campos para el perfil
            const existingContacts = JSON.parse(localStorage.getItem('contacts')) || [];
            const newContact = {
                name,
                email,
                phone,
                allowEmails,
                date: new Date().toLocaleDateString(),
                business,
                position
            };

            // se agrega el objeto contacto al array
            existingContacts.push(newContact);

            // se guarda el array actualizado al localStorage
            localStorage.setItem('contacts', JSON.stringify(existingContacts));

            // mensaje de guardado
            Swal.fire({
                icon: 'success',
                title: 'Contact saved!',
                text: 'Your contact has been added successfully.',
            });

            // se limpia el formulario
            form.reset();
            form.classList.remove('was-validated');

            // se invoca la función para mostrar los contactos guardados
            displayContacts();
        }

        // función para mostrar contactos guardados
        function displayContacts() {
            const contactsList = document.getElementById('contacts-list');
            contactsList.innerHTML = ''; // Clear existing contacts
            const contacts = JSON.parse(localStorage.getItem('contacts')) || [];
            document.getElementById('contact-count').textContent = contacts.length;

            if (contacts.length === 0) {
                contactsList.innerHTML = '<li class="list-group-item text-center">No contacts created</li>';
                return;
            }

            // se crea un elemento li de lista para cada contacto
            contacts.forEach((contact, index) => {
                const badgeClass = contact.allowEmails === 'Permitir Correos' ? 'badge-success' : 'badge-secondary';
                const listItem = document.createElement('li');
                listItem.className = 'list-group-item d-flex justify-content-between align-items-center';
                listItem.innerHTML = `
            <div>
                <h6 class="my-0">${contact.name}</h6>
                <small class="text-muted">${contact.email}</small><br>
                <span class="badge rounded-pill ${badgeClass}">${contact.allowEmails}</span>
            </div>
            <span class="text-muted">${contact.date}</span>
            <button class="btn btn-info btn-sm" onclick="viewContact(${index})"><i class="fas fa-info-circle"></i></button>
            <button class="btn btn-danger btn-sm" onclick="confirmDelete(${index})"><i class="fas fa-trash"></i></button>
        `;
                contactsList.appendChild(listItem);
            });
        }

        // función para borrar contactos y mostrar una confirmación de borrado
        function confirmDelete(index) {
            Swal.fire({
                title: 'Are you sure?',
                text: "Do you want to delete this contact?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    deleteContact(index);
                    Swal.fire(
                        'Deleted!',
                        'Your contact has been deleted.',
                        'success'
                    );
                }
            });
        }


        // función para ver los detallws del contacto
        // view in modal
        function viewContact(index) {
            const contacts = JSON.parse(localStorage.getItem('contacts')) || [];
            const contact = contacts[index];

            const contactInfo = `
            <p><strong>Name:</strong> ${contact.name}</p>
            <p><strong>Email:</strong> ${contact.email}</p>
            <p><strong>Phone:</strong> ${contact.phone}</p>
            <p><strong>Allow Emails:</strong> ${contact.allowEmails === 'Permitir Correos' ? 'Yes' : 'No'}</p>
            <p><strong>Empresa:</strong> ${contact.business === "" ? "No hay registro" : contact.business}</p>
            <p><strong>Puesto:</strong> ${contact.position === "" ? "No hay registro" : contact.position}</p>
            <p><strong>Date Added:</strong> ${contact.date}</p>
        `;

            document.getElementById('modal-body-content').innerHTML = contactInfo;

            const contactModal = new mdb.Modal(document.getElementById('contactModal'));
            contactModal.show();
        }

        // función para borrar un contacto
        function deleteContact(index) {
            const contacts = JSON.parse(localStorage.getItem('contacts')) || [];
            contacts.splice(index, 1); // Remove the contact at the given index
            localStorage.setItem('contacts', JSON.stringify(contacts));
            displayContacts(); // Refresh the contacts display
        }

        // se invoca la función para mostra contactos
        window.onload = displayContacts;
    </script>
</body>

</html>
